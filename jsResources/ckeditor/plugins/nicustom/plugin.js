(function(){function i(a){$(a).removeAttr(g).removeAttr("contenteditable").removeClass(j)}var g="data-ni-option-id",j="editableCell";CKEDITOR.plugins.add("nicustom",{init:function(a){a.addCommand("tableCellToggleEditable",{requiredContent:"table",contextSensitive:!0,refresh:function(a,c){this.setState(c.contains({td:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},exec:function(a){for(var a=a.getSelection().getRanges(),c=0;c<a.length;c++){var d=a[c].getCommonAncestor().getAscendant("td",!0);
d&&(!1===d.hasAttribute(g)?engine.call("GenerateUniqueId").then(function(a){d.addClass(j);d.setAttribute("contentEditable","true");d.setAttribute(g,a)}):i(d.$))}}});a.addCommand("tableHeaderToggleRowHeader",{requiredContent:"table",contextSensitive:!0,refresh:function(a,c){this.setState(c.contains({tbody:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},exec:function(a){for(var a=a.getSelection().getRanges(),c=0;c<a.length;c++){var d=a[c],e=d.getCommonAncestor().getAscendant("tbody",!0),h=
null,b=null,b=b=null;null!==e&&(h=d.createBookmark2(),!0===CKEDITOR.plugins.nicustom.hasRowHeader(e)?(b=$(e.$).children("tr:first"),b=b.children("th"),CKEDITOR.plugins.nicustom.resetRowHeaders(e,b)):(b=$(e.$).children("tr:first"),b=b.children("td"),b.each(function(){void 0!==$(this).attr(g)&&i(this);$(this).replaceWith("<th>"+$(this).html()+"</th>")})),d.moveToBookmark(h),d.select(!0))}}});a.addCommand("tableHeaderToggleColumnHeader",{requiredContent:"table",contextSensitive:!0,refresh:function(a,
c){this.setState(c.contains({tbody:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},exec:function(a){for(var a=a.getSelection().getRanges(),c=0;c<a.length;c++){var d=a[c],e=d.getCommonAncestor().getAscendant("tbody",!0),h=null,b=null,b=b=null;null!==e&&(h=d.createBookmark2(),!0===CKEDITOR.plugins.nicustom.hasColumnHeader(e)?(b=$(e.$).children("tr"),b=$(b).children("th:first-child"),CKEDITOR.plugins.nicustom.resetColumnHeaders(e,b)):(b=$(e.$).children("tr"),b=$(b).children("td:first-child"),
b.each(function(){void 0!==$(this).attr(g)&&i(this);$(this).replaceWith("<th>"+$(this).html()+"</th>")})),d.moveToBookmark(h),d.select(!0))}}})}});CKEDITOR.plugins.nicustom={hasRowHeader:function(a){return null===a?!1:0===$(a.$).children("tr:first").children("td").length},hasColumnHeader:function(a){return null===a?!1:0===$(a.$).children("tr").children("td:first-child").length},isRowHeader:function(a){return null!==a&&a.is("th")&&CKEDITOR.plugins.nicustom.hasRowHeader(a.getAscendant("tbody"))&&$(a.getParent().$).is("tr:first-child")},
isColumnHeader:function(a){return null!==a&&a.is("th")&&CKEDITOR.plugins.nicustom.hasColumnHeader(a.getAscendant("tbody"))&&0===$(a.$).index()},resetColumnHeaders:function(a,f){!0===CKEDITOR.plugins.nicustom.hasRowHeader(a)&&(f=f.slice(1));$(f).each(function(){$(this).replaceWith("<td>"+$(this).html()+"</td>")})},resetRowHeaders:function(a,f){!0===CKEDITOR.plugins.nicustom.hasColumnHeader(a)&&(f=f.slice(1));$(f).each(function(){$(this).replaceWith("<td>"+$(this).html()+"</td>")})}}})();